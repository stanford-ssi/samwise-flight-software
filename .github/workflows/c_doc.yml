name: Claude Documentation

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  issues:
    types: [opened, assigned]
  pull_request_review:
    types: [submitted]

jobs:
  claude:
    if: |
      (
        (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
        (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude')) ||
        (github.event_name == 'pull_request_review' && contains(github.event.review.body, '@claude')) ||
        (github.event_name == 'issues' && (contains(github.event.issue.body, '@claude') || contains(github.event.issue.title, '@claude')))
      ) && (
        github.actor == 'devYaoYH' ||
        github.actor == 'carter-cochran'
      )
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
      issues: read
      id-token: write
      actions: read # Required for Claude to read CI results on PRs
    concurrency:
  group: claude-docs-changelog-${{ github.event.issue.number || github.event.pull_request.number || github.run_id }}
  cancel-in-progress: true
steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 5

      - name: Run Claude Code
        id: claude
        uses: anthropics/claude-code-action@beta
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}

          # This is an optional setting that allows Claude to read CI results on PRs
          additional_permissions: |
            actions: read
          
          # Optional: Specify model (defaults to Claude Haiku 4.5)
          # model='claude-4-5-haiku-latest'
          
          # Optional: Customize the trigger phrase (default: @claude)
          # trigger_phrase: ".claude"
          
          # Optional: Trigger when specific user is assigned to an issue
          # assignee_trigger: "claude-bot"
          
          # Optional: Allow Claude to run specific commands
      
          
          # Optional: Add custom instructions for Claude to customize its behavior for your project
          custom_instructions: |
            Tasks:
            1) If the command includes "docs" or "doc":
              - Inspect the PR's diff to detect all user-visible changes (APIs, CLI flags, behavior, etc.).
              - **Goal: Generate Brief Update Documentation.** For every file or module affected by the PR.
                - If a relevant documentation file exists, propose an update to reflect the changes.
                - If new user-facing code is added without existing documentation, propose the creation of a **new, complete README equivalent paragraph/section** detailing its purpose, usage, and examples.
              - Tone: factual, concise.

            2) If the command includes "changelog" or "change log":
              - write a faux-CHANGELOG.md per "Keep a Changelog" (Added/Changed/Fixed/etc.) in the comments in terse bullets.
              - Summarize PR's user-facing changes in terse bullets (1â€“2 lines), including "(#${{ steps.pr.outputs.number }})" and @contributors.
              - If no user-visible changes, add a note under "Changed" or skip.

            Output Policy (Strict):
            - Post a PR comment containing ONLY a summary paragraph followed by a single ```diff fence.

          
          # Optional: Custom environment variables for Claude
          # claude_env: |
          #   NODE_ENV: test

